#@ load("@ytt:data", "data")
#@ load("@ytt:overlay", "overlay")
#@ load("@ytt:template", "template")
#@ load("/components/toolchain/lib/toolchain.lib.yml", "create_toolchain_components")
#@ load("/lib/util.lib.yml", "datavalue")

#@yaml/text-templated-strings
---
#@ def params():
toolchain_name: host
triple: x86_64-pc-linux-gnu
binutils_version: "2.36.1"
gdb_version: "9.2"
gcc_version: #@ str(datavalue("gcc_host_version"))
gcc_sysroot: /
#! binutils_sysroot: /
extra_gcc_configure_options:
  - --without-cloog
  - --enable-libsanitizer
  - --enable-libssp
  - --enable-shared
  - --enable-libatomic
  - --enable-libquadmath
  - --enable-esp
  - --disable-libstdcxx-pch
  - --enable-threads=posix
  - --enable-__cxa_atexit
  - --enable-clocale=gnu
  - --disable-altivec
  - --disable-fixed-point
  - --enable-targets=all
  - --enable-libgomp
  - --disable-libmudflap
  - --disable-libssp
  - --disable-systemtap
  - --enable-lto
  - --without-isl
  - --enable-default-pie
  - --enable-default-ssp
  - --enable-libmpx
  - CFLAGS_FOR_TARGET="-I/usr/include/tirpc -I$ORCHESTRA_ROOT/link-only/include"
  - CXXFLAGS_FOR_TARGET="-I/usr/include/tirpc -I$ORCHESTRA_ROOT/link-only/include"
  - LDFLAGS_FOR_TARGET="-L$INSTALL_LINK_ONLY_PATH/lib -L$ORCHESTRA_ROOT/lib -lrt --sysroot=/ -Wl,-z,origin -Wl,--enable-new-dtags -Wl,-rpath,$RPATH_PLACEHOLDER/lib"
extra_binutils_configure_options:
  - --enable-gold=default
extra_gcc_make_variables: LIBRARY_PATH=/usr/lib/x86_64-linux-gnu
create_cxx_toolchain_meta_component: false
#@ end

#@overlay/match by=overlay.all, expects=1
#@overlay/match-child-defaults missing_ok=True
---
components:
  _: #@ template.replace(create_toolchain_components(**params()))

  toolchain/host/gcc-toolchain:
    builds:
      default:
        dependencies:
          - toolchain/host/gcc
          - toolchain/host/binutils
        configure: |
          echo "Dummy configure script for toolchain/host/gcc-toolchain"
          mkdir -p "$BUILD_DIR"
        install: |
          echo "Dummy install script for toolchain/host/gcc-toolchain"

  toolchain/host/cxx-toolchain:
    builds:
      default:
        dependencies:
          - glibc
          - toolchain/host/binutils
          - clang-release
        configure: |
          echo "Dummy configure script for toolchain/host/cxx-toolchain"
          mkdir -p "$BUILD_DIR"
        install: |
          echo "Dummy install script for toolchain/host/cxx-toolchain"

  toolchain/host/cxx-runtime:
    builds:
      default:
        dependencies:
          - clang-release
          - toolchain/host/gcc
        configure: |
          echo "Dummy configure script for toolchain/host/cxx-runtime"
          mkdir -p "$BUILD_DIR"
        install: |
          echo "Dummy install script for toolchain/host/cxx-runtime"
